<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="" method="post">
        <input name="email" type="email" placeholder="seu email">
        <input name="senha" type="password" placeholder="senha">
        <button name="btnLogin" type="submit" >entrar</button>
    </form>
    <?php
        include_once('config/conexao.php');
        if($_SERVER["REQUEST_METHOD"] == "POST"){
        // Verifica se houve POST e se o usuário ou a senha é(são) vazio(s)
        if (!empty($_POST) AND (empty($_POST['email']) OR empty($_POST['senha']))) {
        echo "<script>
        setTimeout(function() {
        window.location.replace('http://localhost/af-suplementos/login-cliente.php');
        }, 1000)
        </script>"; exit;
        }
        // Tenta se conectar ao servidor MySQL
        mysql_connect('localhost', 'root', '') or trigger_error(mysql_error());
        // Tenta se conectar a um banco de dados MySQL
        mysql_select_db('af_suplementos') or trigger_error(mysql_error());

        $email = mysql_real_escape_string($_POST['email']);
        $senha = mysql_real_escape_string($_POST['senha']);

        // Validação do usuário/senha digitados
        $sql = "SELECT  `id_cliente`, `email_cliente`, `senha_cliente` FROM `usuarios` WHERE (`email` = '".$usuario ."') AND (`senha` = '". sha1($senha) ."') AND (`ativo` = 1) LIMIT 1";
        $query = mysql_query($sql);
        if (mysql_num_rows($query) != 1) {
        // Mensagem de erro quando os dados são inválidos e/ou o usuário não foi encontrado
        echo "Login inválido!"; exit;
        } else {
        // Salva os dados encontados na variável $resultado
        $resultado = mysql_fetch_assoc($query);
        }
        // Salvando os dados na seção PHP
        if (mysql_num_rows($query) != 1) {
        // Mensagem de erro quando os dados são inválidos e/ou o usuário não foi encontrado
        echo "Login inválido!"; exit;
        } else {
        // Salva os dados encontrados na variável $resultado
        $resultado = mysql_fetch_assoc($query);
                          
        // Se a sessão não existir, inicia uma
        if (!isset($_SESSION)) session_start();
                          
        // Salva os dados encontrados na sessão
        $_SESSION['UsuarioId'] = $resultado['id'];
        $_SESSION['UsuarioNome'] = $resultado['nome'];
        $_SESSION['UsuarioSenha'] = $resultado['senha'];
                          
        // Redireciona o visitante
        echo "<script>
        setTimeout(function() {
        window.location.replace('http://localhost/af-suplementos/index.php');
        }, 1000)
        </script>"; exit;
        }
        }
        ?> 
</body>
</html>